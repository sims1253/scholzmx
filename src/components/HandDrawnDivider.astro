---
export interface Props {
  variant?: 'vine' | 'simple' | 'botanical' | 'ornate';
  width?: 'narrow' | 'medium' | 'wide' | 'full';
  className?: string;
}

const { 
  variant = 'vine',
  width = 'medium',
  className = ''
} = Astro.props;

// Use semantic color tokens via CSS variables
const vineColor = 'var(--color-walnut)';
const leafColor = 'var(--color-accent-secondary)';
const flowerColor = 'var(--color-sage)';
const accentColor = 'var(--color-decorative)';
const strokeWeight = 3;

const widthMapping = {
  narrow: '200px',
  medium: '300px', 
  wide: '400px',
  full: '100%'
};
---

<div class={`hand-drawn-divider hand-drawn-divider--${width} ${className}`}>
  {variant === 'vine' && (
    <svg class="divider-svg" viewBox="0 0 800 64" preserveAspectRatio="xMidYMid meet">
      <defs>
        <filter id="dividerTexture" x="-40%" y="-40%" width="180%" height="180%">
          <feTurbulence baseFrequency="0.03" numOctaves="2" result="noise" seed="3" />
          <feDisplacementMap in="SourceGraphic" in2="noise" scale="1" />
        </filter>

        <filter id="dividerShadow" x="-40%" y="-40%" width="180%" height="180%">
          <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
          <feOffset dx="1" dy="1" result="offset"/>
          <feFlood flood-color="rgba(139, 90, 60, 0.2)"/>
          <feComposite in2="offset" operator="in"/>
          <feMerge> 
            <feMergeNode/>
            <feMergeNode in="SourceGraphic"/> 
          </feMerge>
        </filter>

        <filter id="fillTexture" x="-100%" y="-100%" width="400%" height="400%">
            <feTurbulence baseFrequency="0.002" numOctaves="3" result="noise" seed="5" />
            <feGaussianBlur in="noise" stdDeviation="5" result="smoothed" />
            <feDisplacementMap in="SourceGraphic" in2="smoothed" scale="25" result="displaced" />
            <feGaussianBlur in="displaced" stdDeviation="5" result="finalSmooth" />
          </filter>
          
          <filter id="blur" x="-40%" y="-40%" width="180%" height="180%">
            <feGaussianBlur stdDeviation="0.005" />
          </filter>
      
      </defs>
      
      <!-- Main vine line -->
      <path
        d="M80,32 Q200,20 400,36 T600,24 T720,32"
        stroke={`color-mix(in srgb, ${vineColor} 60%, transparent)`}
        stroke-width={strokeWeight}
        fill="none"
        filter="url(#dividerTexture)"
      />
      
      <!-- Decorative leaves -->
      <g fill={`color-mix(in srgb, ${leafColor} 40%, transparent)`} filter="url(#dividerShadow)">
        <ellipse cx="260" cy="32" rx="8" ry="4" transform="rotate(30 260 32)" />
        <ellipse cx="258" cy="34" rx="5" ry="2.5" transform="rotate(30 258 34)" fill={`color-mix(in srgb, ${vineColor} 30%, transparent)`} />
        <ellipse cx="520" cy="32" rx="7" ry="3.5" transform="rotate(-45 520 32)" />
        <ellipse cx="518" cy="34" rx="4" ry="2" transform="rotate(-45 518 34)" fill={`color-mix(in srgb, ${vineColor} 30%, transparent)`} />
      </g>
      
      <!-- Small decorative dots -->
      <g fill={`color-mix(in srgb, ${flowerColor} 65%, transparent)`}>
        <circle cx="200" cy="32" r="2" />
        <circle cx="400" cy="32" r="1.5" />
        <circle cx="600" cy="32" r="1.8" />
      </g>
    </svg>
  )}
  
  {variant === 'simple' && (
    <svg class="divider-svg" viewBox="0 0 400 24" preserveAspectRatio="xMidYMid meet">
      <defs>
        <filter id="simpleTexture" x="0%" y="0%" width="100%" height="100%">
          <feTurbulence baseFrequency="0.05" numOctaves="1" result="noise" seed="5" />
          <feDisplacementMap in="SourceGraphic" in2="noise" scale="0.8" />
        </filter>
      </defs>
      
      <path
        d="M50,12 Q100,8 150,12 T250,12 T350,12"
        stroke={`color-mix(in srgb, ${vineColor} 50%, transparent)`}
        stroke-width="2"
        fill="none"
        filter="url(#simpleTexture)"
      />
      
      <!-- Central botanical element -->
      <g fill="rgba(90, 107, 71, 0.4)" transform="translate(200, 12)">
        <circle r="3" />
        <ellipse rx="8" ry="2" transform="rotate(45)" fill="rgba(139,69,19,0.3)" />
        <ellipse rx="8" ry="2" transform="rotate(-45)" fill="rgba(139,69,19,0.3)" />
      </g>
    </svg>
  )}
  
  {variant === 'botanical' && (
    <svg class="divider-svg" viewBox="0 0 500 60" preserveAspectRatio="xMidYMid meet">
      <defs>
        <filter id="botanicalTexture" x="-40%" y="-40%" width="180%" height="180%">
          <feTurbulence baseFrequency="0.02" numOctaves="2" result="noise" seed="7" />
          <feDisplacementMap in="SourceGraphic" in2="noise" scale="1" />
        </filter>

        <filter id="blur" x="-40%" y="-40%" width="180%" height="180%">
          <feGaussianBlur stdDeviation="0.5" />
        </filter>
      </defs>
      
      <!-- Central stem (reference spine) -->
      <path
        d="M100,30 Q175,25 250,35 T400,30"
        id="spine"
        stroke={`color-mix(in srgb, ${vineColor} 50%, transparent)`}
        stroke-width="3"
        fill="none"
        filter="url(#blur)"
        stroke-linecap="round"
      />
      
      <!-- Leaves and flowers aligned to spine tangents -->
      <g fill={`color-mix(in srgb, ${leafColor} 42%, transparent)`} stroke={`color-mix(in srgb, ${vineColor} 25%, transparent)`} stroke-width="0.6">
        <!-- Left leaf pair: tangent ~ -10deg at x≈150 -->
        <g transform="translate(150,30) rotate(-10)">
          <ellipse rx="10" ry="4.2" />
          <ellipse rx="8" ry="3.2" transform="rotate(16) translate(6, -1)" />
        </g>
        
        <!-- Central rosette centered on spine apex (x≈250,y≈35) -->
        <g transform="translate(250,35)">
          <circle r="6" fill="rgba(168, 181, 160, 0.5)" />
          <circle r="4" fill="rgba(139,69,19,0.28)" />
          <circle r="2" fill="rgba(234, 179, 8, 0.55)" />
        </g>
        
        <!-- Right leaf pair: tangent ~ +10deg at x≈350 -->
        <g transform="translate(350,30) rotate(10)">
          <ellipse rx="10" ry="4.2" />
          <ellipse rx="8" ry="3.2" transform="rotate(-16) translate(-6, -1)" />
        </g>
      </g>
      
      <!-- Decorative tendrils arcing from spine with mirrored curvature -->
      <g stroke={`color-mix(in srgb, ${leafColor} 30%, transparent)`} stroke-width="1.3" fill="none" stroke-linecap="round">
        <!-- Left tendril: start on spine near x≈170, gentle C matching slope -->
        <path d="M170,33 C176,36 182,35 188,33" />
        <!-- Right tendril: start on spine near x≈312, mirror curve -->
        <path d="M312,33 C318,36 324,35 330,33" />
      </g>
    </svg>
  )}
  
  {variant === 'ornate' && (
    <svg class="divider-svg" viewBox="0 0 700 80" preserveAspectRatio="xMidYMid meet">
      <defs>
        <filter id="ornateTexture" x="0%" y="0%" width="100%" height="100%">
          <feTurbulence baseFrequency="0.025" numOctaves="2" result="noise" seed="9" />
          <feDisplacementMap in="SourceGraphic" in2="noise" scale="1.2" />
        </filter>
        <filter id="ornateShadow" x="0%" y="0%" width="120%" height="120%">
          <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
          <feOffset dx="2" dy="2" result="offset"/>
          <feFlood flood-color="rgba(139, 90, 60, 0.15)"/>
          <feComposite in2="offset" operator="in"/>
          <feMerge> 
            <feMergeNode/>
            <feMergeNode in="SourceGraphic"/> 
          </feMerge>
        </filter>
      </defs>
      
      <!-- Central decorative element -->
      <g transform="translate(350, 40)" filter="url(#ornateShadow)">
        <!-- Ornate center -->
        <circle r="12" fill="rgba(90, 107, 71, 0.3)" />
        <circle r="8" fill="rgba(168, 181, 160, 0.4)" />
        <circle r="4" fill="rgba(234, 179, 8, 0.6)" />
        
        <!-- Radiating elements -->
        <g stroke="rgba(139, 90, 60, 0.5)" stroke-width="2" fill="none">
          <path d="M-20,0 Q-15,-5 -10,0 Q-5,5 0,0" />
          <path d="M20,0 Q15,-5 10,0 Q5,5 0,0" />
          <path d="M0,-20 Q-5,-15 0,-10 Q5,-5 0,0" />
          <path d="M0,20 Q-5,15 0,10 Q5,5 0,0" />
        </g>
      </g>
      
      <!-- Extending vine patterns -->
      <path
        d="M100,40 Q200,30 300,45 Q350,40 400,45 Q500,30 600,40"
        stroke={`color-mix(in srgb, ${vineColor} 40%, transparent)`}
        stroke-width="2.5"
        fill="none"
        filter="url(#ornateTexture)"
      />
      
      <!-- Side decorations -->
      <g fill="rgba(90, 107, 71, 0.3)" filter="url(#ornateTexture)">
        <ellipse cx="150" cy="40" rx="8" ry="4" transform="rotate(20 150 40)" />
        <ellipse cx="550" cy="40" rx="8" ry="4" transform="rotate(-20 550 40)" />
      </g>
    </svg>
  )}
</div>

<style>
  .hand-drawn-divider {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: var(--spacing-component) auto;
  }

  .hand-drawn-divider--narrow { max-width: 200px; }
  .hand-drawn-divider--medium { max-width: 300px; }
  .hand-drawn-divider--wide { max-width: 400px; }
  .hand-drawn-divider--full { max-width: 100%; }

  .divider-svg {
    width: 100%;
    height: auto;
    filter: drop-shadow(0 1px 2px rgba(139, 90, 60, 0.1));
  }

  /* Responsive sizing */
  @media (max-width: 768px) {
    .hand-drawn-divider {
      margin: var(--space-md) auto;
    }
    
    .hand-drawn-divider--wide,
    .hand-drawn-divider--medium {
      max-width: 200px;
    }
  }

  @media (max-width: 480px) {
    .hand-drawn-divider--narrow,
    .hand-drawn-divider--medium,
    .hand-drawn-divider--wide {
      max-width: 160px;
    }
  }
</style>