---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import NoteCardStack from '../components/NoteCardStack.astro';

const allRecipes = await getCollection('recipes', ({ data }) => !data.draft);
const recipes = allRecipes.sort((a, b) => a.data.title.localeCompare(b.data.title));
---

<BaseLayout
  title="Recipes"
  description="Personal kitchen notes and recipes."
  footerVariant="kitchen"
  longform={false}
  personal={true}
  contentWidth="full"
>
  <div class="recipes-page">
    <header class="recipes-header">
      <h1 class="page-title">Recipes</h1>
      <p class="page-description">Personal and seasonal â€” collected kitchen notes.</p>
    </header>

    <div class="recipes-container">
      <main class="recipes-content">
        <section aria-label="Recipes">
          <NoteCardStack
            columns={1}
            items={recipes.map((r) => ({
              id: r.slug,
              title: r.data.title,
              subtitle: r.data.description,
              href: `/recipes/${r.slug}`,
              hero: r.data.heroImage
                ? {
                    kind: 'asset',
                    src: r.data.heroImage,
                    scale: (r.data as any).heroImageScale || 1,
                    posX: (r.data as any).heroImagePositionX || 0,
                    posY: (r.data as any).heroImagePositionY || 0,
                  }
                : undefined,
            }))}
          />
        </section>
      </main>
    </div>
  </div>
</BaseLayout>

<style>
  .recipes-page {
    max-width: 100%;
  }

  .recipes-header {
    text-align: center;
    max-width: var(--content-width-listing);
    margin: 0 auto var(--space-xs);
  }

  .page-title {
    font-size: clamp(var(--text-2xl), 5vw, var(--text-3xl));
    margin-bottom: var(--space-xs);
    color: var(--color-ink-dark);
  }

  .page-description {
    font-size: var(--text-lg);
    line-height: 1.6;
    color: var(--color-ink-medium);
    font-style: italic;
    text-align: center;
    margin-left: auto;
    margin-right: auto;
  }

  .recipes-container {
    max-width: var(--content-width-listing);
    margin: 0 auto;
  }

  .recipes-content {
    position: relative;
  }
</style>
